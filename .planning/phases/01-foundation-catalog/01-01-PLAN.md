---
phase: 01-foundation-catalog
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - next.config.ts
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/globals.css
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - src/lib/types.ts
  - .env.local.example
  - supabase/migrations/001_initial_schema.sql
autonomous: true
user_setup:
  - service: supabase
    why: "Database and authentication"
    env_vars:
      - name: NEXT_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: NEXT_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon/public key"
    dashboard_config:
      - task: "Create a new Supabase project"
        location: "https://supabase.com/dashboard -> New Project"

must_haves:
  truths:
    - "Next.js development server starts without errors"
    - "Supabase tables exist in database"
    - "Tailwind v4 styles apply correctly"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies"
      contains: "@supabase/ssr"
    - path: "src/app/globals.css"
      provides: "Tailwind v4 theme configuration"
      contains: "@theme"
    - path: "src/lib/supabase/server.ts"
      provides: "Server-side Supabase client"
      exports: ["createClient"]
    - path: "supabase/migrations/001_initial_schema.sql"
      provides: "Database schema"
      contains: "CREATE TABLE products"
  key_links:
    - from: "src/lib/supabase/server.ts"
      to: "cookies from next/headers"
      via: "createServerClient"
      pattern: "createServerClient.*cookies"
    - from: "src/app/globals.css"
      to: "Tailwind"
      via: "@import"
      pattern: "@import.*tailwindcss"
---

<objective>
Initialize Next.js 15 project with Tailwind v4, Supabase client configuration, and database schema for the medical product catalog.

Purpose: Establish the technical foundation that all subsequent plans depend on - the Next.js application structure, database schema, and Supabase connectivity.

Output: Runnable Next.js development server with Supabase schema ready for data population.
</objective>

<execution_context>
@C:\Users\kazda\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\kazda\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-catalog/01-RESEARCH.md
@.planning/phases/01-foundation-catalog/01-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Next.js project with dependencies</name>
  <files>
    package.json
    tsconfig.json
    next.config.ts
    src/app/layout.tsx
    src/app/page.tsx
    src/app/globals.css
    src/lib/supabase/client.ts
    src/lib/supabase/server.ts
    src/lib/types.ts
    .env.local.example
  </files>
  <action>
Create Next.js 15 project using `npx create-next-app@latest . --typescript --tailwind --eslint --app --src-dir --import-alias "@/*"` (accept defaults for other prompts).

After scaffolding, install additional dependencies:
```bash
npm install @supabase/supabase-js @supabase/ssr @tanstack/react-table motion usehooks-ts lucide-react
npm install -D xlsx
```

Create Supabase client files following the @supabase/ssr pattern from RESEARCH.md:

**src/lib/supabase/server.ts** - Server client using cookies() from next/headers. Must use `await cookies()` (Next.js 15 async cookies API).

**src/lib/supabase/client.ts** - Browser client using createBrowserClient singleton.

**src/lib/types.ts** - TypeScript types for database entities:
- `Vendor`: id, name, code, website, created_at, updated_at
- `EMDNCategory`: id, code, name, parent_id, depth, path, created_at
- `Material`: id, name, code
- `Product`: id, name, sku, description, price, vendor_id, emdn_category_id, material_id, created_at, updated_at
- `ProductWithRelations`: Product with nested vendor, emdn_category, material objects

**src/app/globals.css** - Replace default Tailwind imports with v4 syntax:
```css
@import "tailwindcss";

@theme {
  --color-background: #ffffff;
  --color-foreground: #0a0a0a;
  --color-muted: #f5f5f5;
  --color-muted-foreground: #737373;
  --color-border: #e5e5e5;
  --color-accent: #2563eb;
  --color-accent-foreground: #ffffff;
  --color-table-header: #fafafa;
  --color-table-row-alt: #fafafa;
  --color-table-row-hover: #f5f5f5;
  --font-sans: Inter, ui-sans-serif, system-ui, sans-serif;
  --radius-sm: 0.25rem;
  --radius-md: 0.375rem;
}
```

**src/app/layout.tsx** - Root layout with Inter font, metadata for "MedCatalog".

**src/app/page.tsx** - Simple redirect or placeholder that will become the catalog page.

**.env.local.example** - Template showing required env vars:
```
NEXT_PUBLIC_SUPABASE_URL=your-project-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
```

Do NOT create tailwind.config.js - Tailwind v4 uses CSS-first configuration.
  </action>
  <verify>
Run `npm run dev` - server starts on localhost:3000 without errors.
Visit localhost:3000 - page renders with styled content.
Check that Inter font loads.
  </verify>
  <done>
Next.js 15 project runs with Tailwind v4 styling, Supabase clients configured (awaiting env vars), and TypeScript types defined.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase database schema</name>
  <files>
    supabase/migrations/001_initial_schema.sql
  </files>
  <action>
Create the SQL migration file with the complete schema from RESEARCH.md:

**supabase/migrations/001_initial_schema.sql**:

```sql
-- Vendors table
CREATE TABLE vendors (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  code TEXT UNIQUE,
  website TEXT,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);

-- EMDN Categories (hierarchical)
CREATE TABLE emdn_categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  parent_id UUID REFERENCES emdn_categories(id),
  depth INTEGER NOT NULL DEFAULT 0,
  path TEXT,
  created_at TIMESTAMPTZ DEFAULT now()
);
CREATE INDEX idx_emdn_parent ON emdn_categories(parent_id);
CREATE INDEX idx_emdn_path ON emdn_categories(path);
CREATE INDEX idx_emdn_code ON emdn_categories(code);

-- Materials lookup
CREATE TABLE materials (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  code TEXT UNIQUE
);

-- Products
CREATE TABLE products (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,
  sku TEXT NOT NULL,
  description TEXT,
  price DECIMAL(10,2),
  vendor_id UUID REFERENCES vendors(id),
  emdn_category_id UUID REFERENCES emdn_categories(id),
  material_id UUID REFERENCES materials(id),
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now()
);
CREATE INDEX idx_products_vendor ON products(vendor_id);
CREATE INDEX idx_products_emdn ON products(emdn_category_id);
CREATE INDEX idx_products_material ON products(material_id);
CREATE INDEX idx_products_name ON products USING gin(to_tsvector('english', name));
CREATE INDEX idx_products_sku ON products(sku);

-- RLS Policies (public read for catalog)
ALTER TABLE vendors ENABLE ROW LEVEL SECURITY;
ALTER TABLE emdn_categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE materials ENABLE ROW LEVEL SECURITY;
ALTER TABLE products ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Public read vendors" ON vendors FOR SELECT USING (true);
CREATE POLICY "Public read emdn" ON emdn_categories FOR SELECT USING (true);
CREATE POLICY "Public read materials" ON materials FOR SELECT USING (true);
CREATE POLICY "Public read products" ON products FOR SELECT USING (true);

-- Updated_at trigger function
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER vendors_updated_at
  BEFORE UPDATE ON vendors
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();

CREATE TRIGGER products_updated_at
  BEFORE UPDATE ON products
  FOR EACH ROW EXECUTE FUNCTION update_updated_at();
```

Note: The migration file is created locally. User will need to run it against their Supabase project via Supabase Dashboard SQL editor or Supabase CLI. Include instructions in the SUMMARY.

Important: SKU is NOT unique constraint - same SKU can exist from different vendors (that's the price comparison use case).
  </action>
  <verify>
File exists at supabase/migrations/001_initial_schema.sql.
SQL syntax is valid (no obvious errors).
All four tables defined: vendors, emdn_categories, materials, products.
RLS policies enable public read.
  </verify>
  <done>
Database schema SQL file ready for execution against Supabase. Includes all tables, indexes, RLS policies, and update triggers.
  </done>
</task>

</tasks>

<verification>
1. `npm run dev` starts without errors
2. Visit http://localhost:3000 - page loads with styled content
3. src/lib/supabase/server.ts exports createClient function
4. src/lib/supabase/client.ts exports createClient function
5. src/lib/types.ts exports Product, Vendor, EMDNCategory, Material types
6. supabase/migrations/001_initial_schema.sql exists with valid SQL
7. .env.local.example documents required environment variables
</verification>

<success_criteria>
- Next.js 15 project scaffolded with App Router
- All dependencies installed (@supabase/ssr, @tanstack/react-table, motion, usehooks-ts, lucide-react, xlsx)
- Tailwind v4 configured via @theme in globals.css
- Supabase server and browser clients implemented
- TypeScript types defined for all database entities
- SQL migration file ready for database setup
- Development server runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-catalog/01-01-SUMMARY.md`
</output>
