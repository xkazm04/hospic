---
phase: 01-foundation-catalog
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - scripts/import-emdn.ts
  - scripts/seed-data.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "EMDN categories exist in database with orthopedic-relevant entries"
    - "Sample vendors exist in database"
    - "Sample products exist with relations to vendors, categories, and materials"
  artifacts:
    - path: "scripts/import-emdn.ts"
      provides: "EMDN Excel parser and importer"
      min_lines: 50
    - path: "scripts/seed-data.ts"
      provides: "Test data seeder"
      min_lines: 30
  key_links:
    - from: "scripts/import-emdn.ts"
      to: "supabase"
      via: "@supabase/supabase-js"
      pattern: "createClient|supabase\\.from"
    - from: "scripts/seed-data.ts"
      to: "emdn_categories table"
      via: "foreign key reference"
      pattern: "emdn_category_id"
---

<objective>
Parse the EMDN V2_EN.xlsx file to import orthopedic-relevant categories and seed the database with sample vendors, materials, and products for development.

Purpose: Populate the database with real EMDN classification data and realistic test data so the catalog UI can be developed and tested against actual data.

Output: Populated database with EMDN hierarchy, vendors, materials, and sample products.
</objective>

<execution_context>
@C:\Users\kazda\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\kazda\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-catalog/01-RESEARCH.md
@.planning/phases/01-foundation-catalog/01-CONTEXT.md
@.planning/phases/01-foundation-catalog/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EMDN import script</name>
  <files>
    scripts/import-emdn.ts
    package.json
  </files>
  <action>
First, read the EMDN V2_EN.xlsx file structure using xlsx library to understand the column layout. The Excel file is in the project root.

Create **scripts/import-emdn.ts** that:

1. Uses xlsx (SheetJS) to read "EMDN V2_EN.xlsx" from project root
2. Parses the spreadsheet to extract category code and name columns
3. Filters to orthopedic-relevant categories. EMDN orthopedic categories are typically:
   - P section: Implantable prosthetic devices (includes orthopedic implants)
   - J section: Non-active implantable devices (includes bone substitutes)
   - Look for codes starting with P09 (orthopedic implants), P03 (cardiovascular but check), J (general implants)
   - Also include parent categories needed for hierarchy (P, J at minimum)
4. Builds hierarchical structure using parent_id references
5. Computes depth and path for each category
6. Uses Supabase client to insert categories (use service role key for insert, or temporarily disable RLS)

The script should:
- Be runnable with `npx tsx scripts/import-emdn.ts`
- Use environment variables for Supabase connection
- Handle the hierarchical nature (insert parents before children)
- Log progress and final count

Add to package.json scripts:
```json
"import:emdn": "tsx scripts/import-emdn.ts"
```

If tsx is not installed, add it: `npm install -D tsx`

Note: The script will need SUPABASE_SERVICE_ROLE_KEY for insert operations (service role bypasses RLS), or user can temporarily allow inserts via Supabase dashboard.

Create **.env.local.example** entry for:
```
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```
  </action>
  <verify>
Run `npm run import:emdn` - script executes and logs imported category count.
Check Supabase dashboard - emdn_categories table has orthopedic categories with proper hierarchy.
Verify parent_id references are correct (children link to parents).
  </verify>
  <done>
EMDN import script successfully parses Excel file and populates emdn_categories table with orthopedic-relevant hierarchy.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create seed data script</name>
  <files>
    scripts/seed-data.ts
    package.json
  </files>
  <action>
Create **scripts/seed-data.ts** that populates test data:

**Vendors** (3-4 realistic orthopedic suppliers):
- DePuy Synthes (Johnson & Johnson company)
- Stryker Corporation
- Zimmer Biomet
- Smith & Nephew

**Materials** (common orthopedic materials):
- Titanium Alloy (Ti-6Al-4V)
- Stainless Steel (316L)
- Cobalt Chrome
- PEEK (Polyether Ether Ketone)
- UHMWPE (Ultra-High Molecular Weight Polyethylene)

**Products** (15-20 sample orthopedic products):
Create realistic orthopedic products with:
- Bone screws (various sizes: 3.5mm, 4.5mm cortical screws)
- Bone plates (reconstruction plates, locking plates)
- Hip implants (femoral stems, acetabular cups)
- Knee implants (tibial components, femoral components)
- Spinal implants (pedicle screws, interbody cages)

Each product should have:
- Realistic name (e.g., "3.5mm Cortical Screw, Self-Tapping, 30mm")
- SKU (vendor prefix + number, e.g., "DPS-CS-3530")
- Description
- Price (realistic medical device pricing: $50-$5000 range)
- Vendor reference
- EMDN category reference (query existing categories)
- Material reference

The script should:
- Query existing emdn_categories to find appropriate category IDs
- Insert vendors first, then materials, then products
- Use realistic pricing that varies by vendor (same product, different vendor, different price)
- Include some products that exist from multiple vendors (to test price comparison later)

Add to package.json scripts:
```json
"seed": "tsx scripts/seed-data.ts"
```
  </action>
  <verify>
Run `npm run seed` - script executes successfully.
Check Supabase dashboard:
- vendors table has 4 entries
- materials table has 5 entries
- products table has 15-20 entries with proper foreign key references
Query products with joins - verify relations resolve correctly.
  </verify>
  <done>
Seed script populates database with realistic orthopedic product data including vendors, materials, and products with proper relationships.
  </done>
</task>

</tasks>

<verification>
1. `npm run import:emdn` completes without errors
2. emdn_categories table contains orthopedic categories with hierarchy
3. `npm run seed` completes without errors
4. vendors table has vendor records
5. materials table has material records
6. products table has product records with valid foreign keys
7. Supabase query with joins returns products with related vendor/category/material data
</verification>

<success_criteria>
- EMDN Excel file parsed and orthopedic categories imported
- Hierarchical category structure preserved (parent_id, depth, path)
- Sample vendors, materials, and products seeded
- Products have realistic pricing and relationships
- Some products exist from multiple vendors (for future price comparison)
- Scripts are idempotent (can be re-run) or at least handle existing data gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-catalog/01-02-SUMMARY.md`
</output>
