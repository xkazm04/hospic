---
phase: 01-foundation-catalog
plan: 03
type: execute
wave: 3
depends_on: ["01-01", "01-02"]
files_modified:
  - src/app/page.tsx
  - src/app/loading.tsx
  - src/components/table/data-table.tsx
  - src/components/table/columns.tsx
  - src/components/table/table-pagination.tsx
  - src/components/filters/filter-sidebar.tsx
  - src/components/filters/category-tree.tsx
  - src/components/filters/search-input.tsx
  - src/components/filters/price-range-filter.tsx
  - src/components/filters/vendor-filter.tsx
  - src/components/filters/material-filter.tsx
  - src/components/ui/dropdown-menu.tsx
  - src/lib/queries.ts
autonomous: false

must_haves:
  truths:
    - "User can view products in a sortable table with frozen header"
    - "User can filter products by vendor, EMDN category, price range, and material"
    - "User can paginate through products (20 per page)"
    - "User can search products by name, description, or SKU"
    - "Table displays with light theme styling and smooth animations"
  artifacts:
    - path: "src/components/table/data-table.tsx"
      provides: "Main data table component"
      min_lines: 80
    - path: "src/components/filters/category-tree.tsx"
      provides: "EMDN hierarchy tree filter"
      min_lines: 50
    - path: "src/app/page.tsx"
      provides: "Products catalog page with server-side data fetching"
      min_lines: 40
  key_links:
    - from: "src/app/page.tsx"
      to: "supabase"
      via: "createClient and query"
      pattern: "createClient.*from\\('products'\\)"
    - from: "src/components/table/data-table.tsx"
      to: "@tanstack/react-table"
      via: "useReactTable"
      pattern: "useReactTable"
    - from: "src/components/filters/search-input.tsx"
      to: "URL searchParams"
      via: "router.push"
      pattern: "router\\.push.*search"
    - from: "src/components/filters/category-tree.tsx"
      to: "URL searchParams"
      via: "onSelect handler"
      pattern: "category"
---

<objective>
Build the complete product catalog UI with data table, filtering sidebar, search, pagination, and Framer Motion animations.

Purpose: Deliver the core user-facing feature of Phase 1 - a browsable, searchable, filterable product catalog that meets all the phase success criteria.

Output: Fully functional catalog page where users can browse, filter, search, and paginate through orthopedic products.
</objective>

<execution_context>
@C:\Users\kazda\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\kazda\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-catalog/01-RESEARCH.md
@.planning/phases/01-foundation-catalog/01-CONTEXT.md
@.planning/phases/01-foundation-catalog/01-01-SUMMARY.md
@.planning/phases/01-foundation-catalog/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create data table with server-side pagination</name>
  <files>
    src/app/page.tsx
    src/app/loading.tsx
    src/components/table/data-table.tsx
    src/components/table/columns.tsx
    src/components/table/table-pagination.tsx
    src/components/ui/dropdown-menu.tsx
    src/lib/queries.ts
  </files>
  <action>
Create the product catalog table following RESEARCH.md patterns and CONTEXT.md design decisions.

**src/lib/queries.ts** - Supabase query functions:
- `getProducts(params)`: Fetches products with pagination, sorting, filtering
  - Uses server Supabase client
  - Accepts: page, pageSize, search, vendor, category, material, minPrice, maxPrice, sortBy, sortOrder
  - Uses .range() for pagination
  - Uses .ilike() for search across name, description, sku
  - Returns { data, count, error }
- `getVendors()`: Fetches all vendors for filter dropdown
- `getMaterials()`: Fetches all materials for filter dropdown
- `getEMDNCategories()`: Fetches categories as nested tree structure

**src/app/page.tsx** - Server Component:
- Receives searchParams as Promise (Next.js 15 pattern: `searchParams: Promise<{...}>`)
- Awaits searchParams, then calls getProducts with filter params
- Fetches vendors, materials, categories for filter sidebar
- Renders FilterSidebar and DataTable
- Layout: sidebar on left (fixed width ~280px), table on right (flex-1)

**src/app/loading.tsx** - Loading skeleton:
- Skeleton for sidebar filters
- Skeleton rows for table

**src/components/table/data-table.tsx** - Client Component ('use client'):
- Uses TanStack Table with manualPagination: true, manualSorting: true
- Receives data, columns, pageCount as props
- URL searchParams is source of truth (read via useSearchParams)
- Updates URL on sort/page change via router.push
- Renders table with:
  - Sticky header (position: sticky, top: 0, z-index)
  - Compact row density (py-2 px-3)
  - Zebra striping (odd:bg-table-row-alt)
  - Hover state (hover:bg-table-row-hover)
  - Motion animations on row enter (staggered, opacity + translateY)
- Uses flexRender for cell rendering

**src/components/table/columns.tsx** - Column definitions:
- Product name + SKU (combined cell, SKU in muted text below name)
- Vendor (vendor.name)
- Price (formatted with currency, right-aligned)
- EMDN Category (emdn_category.name, no code shown per CONTEXT.md)
- Actions column: dropdown menu with "View details" (disabled for now, Phase 2)

**src/components/table/table-pagination.tsx** - Pagination controls:
- Previous/Next buttons
- Page number display (Page X of Y)
- Items per page (fixed at 20, or dropdown for 10/20/50)
- Total count display

**src/components/ui/dropdown-menu.tsx** - Simple dropdown for row actions:
- Trigger: vertical dots icon (MoreVertical from lucide-react)
- Menu items with hover states
- Use Motion for open/close animation

Design per CONTEXT.md decisions:
- Compact row density
- Sticky header with subtle gray background (bg-table-header)
- Actions via dropdown (three-dot menu), not visible buttons
- No horizontal scroll - all columns fit
  </action>
  <verify>
Visit localhost:3000 - products display in table format.
Table has sticky header that stays visible on scroll.
Clicking column headers triggers sort (URL updates with sort params).
Pagination controls work (URL updates with page param).
Row actions dropdown opens on click.
  </verify>
  <done>
Data table displays products with sorting, pagination, sticky header, compact styling, and row action dropdowns.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create filter sidebar with all filter types</name>
  <files>
    src/components/filters/filter-sidebar.tsx
    src/components/filters/category-tree.tsx
    src/components/filters/search-input.tsx
    src/components/filters/price-range-filter.tsx
    src/components/filters/vendor-filter.tsx
    src/components/filters/material-filter.tsx
  </files>
  <action>
Create the filter sidebar following RESEARCH.md patterns.

**src/components/filters/filter-sidebar.tsx** - Container component:
- Fixed width sidebar (~280px)
- Contains all filter components vertically stacked
- Section headers for each filter group
- "Clear all filters" button at bottom
- Subtle border on right edge

**src/components/filters/search-input.tsx** - Client Component:
- Text input with search icon (Search from lucide-react)
- Uses useDebounce from usehooks-ts (300ms)
- Updates URL searchParams on debounced value change
- Resets page to 1 on search change
- Placeholder: "Search products..."

**src/components/filters/category-tree.tsx** - Client Component:
- Recursive tree component for EMDN hierarchy (from RESEARCH.md Pattern 5)
- Expandable nodes with chevron icons
- Click to select category (updates URL ?category=id)
- Selected category highlighted with accent color
- Full depth available per CONTEXT.md
- Motion animation for expand/collapse

**src/components/filters/vendor-filter.tsx** - Client Component:
- Checkbox list of vendors
- Multiple selection allowed (comma-separated in URL ?vendor=id1,id2)
- Shows vendor name with product count if available
- Updates URL on change

**src/components/filters/material-filter.tsx** - Client Component:
- Checkbox list of materials
- Multiple selection allowed (comma-separated in URL ?material=id1,id2)
- Updates URL on change

**src/components/filters/price-range-filter.tsx** - Client Component:
- Two number inputs: min and max price
- Uses debounce before updating URL
- Updates URL params ?minPrice=X&maxPrice=Y
- Shows current range or "Any price" if not set

All filters must:
- Read initial state from URL searchParams
- Update URL on change (router.push with new params)
- Reset page to 1 when filter changes
- Be visually consistent (same spacing, typography)
  </action>
  <verify>
Search input filters products by name/SKU (debounced).
Category tree expands/collapses with animation.
Selecting a category filters the table.
Vendor checkboxes filter by selected vendors.
Material checkboxes filter by selected materials.
Price range inputs filter by min/max price.
URL reflects all active filters.
Page refresh preserves filter state.
  </verify>
  <done>
Filter sidebar fully functional with search, category tree, vendor/material checkboxes, and price range - all synced to URL params.
  </done>
</task>

<task type="auto">
  <name>Task 3: Polish styling and animations</name>
  <files>
    src/app/globals.css
    src/components/table/data-table.tsx
    src/components/filters/filter-sidebar.tsx
    src/components/filters/category-tree.tsx
  </files>
  <action>
Apply final polish to meet CONTEXT.md requirements: "elegant and dynamic design in light themes", "advanced typography and border techniques", "avoid dead spaces".

**Typography refinements:**
- Product name: font-medium, text-foreground
- SKU: text-sm, text-muted-foreground
- Price: tabular-nums, font-medium
- Category: text-sm
- Filter labels: text-sm, font-medium, text-muted-foreground uppercase

**Spacing and borders:**
- Compact cell padding (py-2 px-3)
- Subtle border between filter sections
- Card-like container for table with subtle shadow
- Proper margin between sidebar and table

**Animations (Motion):**
- Table rows: staggered fade-in on data load (limit to first 10-15 rows)
- Category tree: smooth height animation on expand/collapse
- Filter sidebar: subtle slide-in on page load (optional)
- Dropdown menu: scale + fade animation
- Hover states: transition-colors duration-150

**Empty and loading states:**
- Empty state when no products match filters: centered message with icon
- Loading skeleton matches final layout structure

**Final layout structure:**
```
+------------------+----------------------------------------+
|  Filter Sidebar  |           Data Table                   |
|  (280px fixed)   |           (flex-1)                     |
|                  |                                        |
|  [Search]        |  [Sticky Header]                       |
|                  |  Name+SKU | Vendor | Price | EMDN | â‹®  |
|  Categories      |  ----------------------------------------
|  > Implants      |  Row 1                                 |
|    > Bone        |  Row 2 (alt bg)                        |
|    > Hip         |  Row 3                                 |
|                  |  ...                                   |
|  Vendors         |                                        |
|  [x] DePuy       |  [Pagination: < Page 1 of 5 >]         |
|  [ ] Stryker     |                                        |
+------------------+----------------------------------------+
```
  </action>
  <verify>
Visual inspection: table looks polished with good typography.
Animations are smooth but not distracting.
No dead spaces - content is compact and purposeful.
Empty state displays when filters return no results.
Loading skeleton appears during data fetch.
All interactions feel responsive.
  </verify>
  <done>
Catalog UI polished with elegant typography, subtle animations, and professional light theme appearance.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete product catalog with:
- Server-side paginated data table with sorting
- Filter sidebar (search, EMDN tree, vendor, material, price range)
- Sticky header, compact rows, row action dropdowns
- Motion animations and light theme styling
  </what-built>
  <how-to-verify>
1. Visit http://localhost:3000
2. Verify table displays products with all columns visible
3. Scroll down - header should stay sticky
4. Click column header - table should sort (check URL changes)
5. Use pagination controls - navigate between pages
6. Type in search box - table should filter after debounce
7. Expand EMDN category tree - select a category - table filters
8. Check vendor filter checkboxes - table filters
9. Enter price range - table filters
10. Combine multiple filters - all should work together
11. Refresh page - filters should persist from URL
12. Check row animations on page load/filter change
13. Verify overall visual polish matches "elegant light theme" requirement
  </how-to-verify>
  <resume-signal>Type "approved" if catalog meets Phase 1 requirements, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Products display in sortable, paginated table
2. All 5 filter types work (search, category, vendor, material, price)
3. Filters sync to URL and persist on refresh
4. Sticky header stays visible on scroll
5. Row actions dropdown works
6. Animations are smooth
7. Visual design is elegant and compact
8. Empty state shows when no results
9. Loading skeleton appears during fetch
</verification>

<success_criteria>
Phase 1 Success Criteria (from ROADMAP.md):
1. User can view products in a sortable table with frozen header - VERIFIED
2. User can filter products by vendor, EMDN category, price range, and material - VERIFIED
3. User can paginate through products (20 per page) - VERIFIED
4. User can search products by name, description, or SKU - VERIFIED
5. Table displays with light theme styling and smooth Framer Motion animations - VERIFIED
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-catalog/01-03-SUMMARY.md`
</output>
